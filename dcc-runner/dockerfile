FROM dcc-help:base AS build


# Helper for website runtime:
COPY runner-src/* /opt/dcc-help/lib
RUN  chmod 755 /opt/dcc-help/lib/gcc /opt/dcc-help/lib/compile.sh

FROM gcr.io/distroless/cc-debian12:nonroot


COPY --from=build /usr /usr
COPY --from=build /lib  /lib
COPY --from=build /lib64 /lib64
COPY --from=build /opt /opt
COPY --from=build /bin/bash /bin/bash
COPY --from=build /bin/sh /bin/sh

ENV PATH="/opt/dcc-help/lib:/usr/local/bin:/usr/bin/"
WORKDIR "/home/nonroot"

ENTRYPOINT ["/opt/dcc-help/lib/compile.sh"]